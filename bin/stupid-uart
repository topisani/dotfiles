#!/bin/sh

if [ "$#" -lt "1" ]; then
  echo "Stupid serial communication."
  echo "Sets baudrate, outputs from device, sends lines from stdin. Thats it."
  echo ""
  echo "Usage: stupid-uart <device> [baudrate]"
  echo ""
  echo "  <device>  : device path, fx: /dev/ttyUSB0"
  echo "  <baudrate>: baudrate, defaults to 115200"
  exit 1
fi

DEVICE=${1}
BAUDRATE=${2:-115200}

trap "exit" INT TERM
trap "kill 0" EXIT

stty -echo $BAUDRATE -F $DEVICE

echo ""

cat $DEVICE | while read line; do
  printf "\033[s" # Save cursor
  printf "\033[0G" # Go to column 0
  tput setaf 12
  printf "%s" "$line"
  tput sgr0
  printf "\033[u" # Restore cursor
  echo ""
done &
cat >> $DEVICE
